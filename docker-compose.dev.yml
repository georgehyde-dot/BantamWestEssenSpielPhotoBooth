version: '3.8'

services:
  photo-booth-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: photo_booth_dev

    # Mount source code for hot reloading
    volumes:
      - .:/workspace
      - photo_booth_data:/usr/local/share/photo_booth
      # If you have a USB camera, you can pass it through:
      # - /dev/video0:/dev/video0

    # Pass through video devices (uncomment if you have a camera)
    # devices:
    #   - /dev/video0:/dev/video0

    ports:
      - "8080:8080"

    environment:
      # Development environment
      - RUST_LOG=debug
      - RUST_BACKTRACE=full

      # Application configuration
      - HOST=0.0.0.0
      - PORT=8080

      # Camera configuration (using mock/test device)
      - VIDEO_DEVICE=/dev/video0
      - VIDEO_WIDTH=1920
      - VIDEO_HEIGHT=1080
      - VIDEO_FORMAT=MJPG

      # Storage configuration
      - STORAGE_PATH=/usr/local/share/photo_booth
      - DATABASE_PATH=/usr/local/share/photo_booth/photo_booth.db

      # Printer configuration (mock for development)
      - USE_MOCK_PRINTER=true
      - PRINTER_NAME=Mock_Printer

      # Template configuration
      - TEMPLATE_HEADER=Development Test

    # Enable terminal for interactive debugging
    stdin_open: true
    tty: true

    # Privileged mode may be needed for device access
    # privileged: true

    # Network mode for CUPS if testing real printing
    # network_mode: host

volumes:
  photo_booth_data:
    driver: local
