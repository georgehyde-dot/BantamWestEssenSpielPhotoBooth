REFACTORING TASK: Platform-Specific Code - REVISED FOR LINUX-ONLY
=================================================================

OBJECTIVE:
Convert the codebase to Linux-only by either:
1. Using container-based development (RECOMMENDED)
2. Removing all platform conditionals and non-Linux code

CURRENT SITUATION:
- The codebase has 200+ #[cfg(target_os = "linux")] conditionals
- Non-Linux stub implementations exist but are never used in production
- Development is done on macOS but deployment is Linux-only
- The conditional compilation makes the code harder to read and maintain

APPROACH 1: CONTAINER-BASED DEVELOPMENT (RECOMMENDED)
====================================================

This approach keeps you developing on macOS while ensuring Linux compatibility.

SETUP STEPS:

1. Use the provided development environment:
   ```bash
   # Make the helper script executable
   chmod +x dev.sh

   # Start development environment
   ./dev.sh up

   # Enter the container for development
   ./dev.sh shell

   # Or run with hot reload
   ./dev.sh watch
   ```

2. Development workflow:
   - Edit code on your Mac using your preferred editor
   - Code is mounted into the container via volume
   - Container runs the Linux version with all dependencies
   - Hot reload works through cargo-watch

3. Benefits:
   - Develop on Mac, run on Linux
   - All Linux dependencies available
   - Consistent environment with production
   - No need to modify code

APPROACH 2: REMOVE ALL CONDITIONALS (ALTERNATIVE)
=================================================

If container development is not suitable, remove all conditional compilation.

FILES TO MODIFY:
- src/main.rs - Remove all #[cfg] attributes and non-Linux code
- src/camera.rs - Keep only Linux implementation
- src/printers.rs - Keep only Linux implementation
- src/templates.rs - Keep only Linux implementation
- src/image_processing.rs - Keep only Linux implementation
- src/routes/*.rs - Remove platform checks
- Cargo.toml - Update dependencies to be Linux-only

REFACTORING STEPS:

1. Remove all #[cfg(not(target_os = "linux"))] blocks:
   ```rust
   // DELETE THIS ENTIRE BLOCK:
   #[cfg(not(target_os = "linux"))]
   fn main() {
       // stub implementation
   }
   ```

2. Remove all #[cfg(target_os = "linux")] attributes but keep the code:
   ```rust
   // BEFORE:
   #[cfg(target_os = "linux")]
   use v4l::device::Device;

   // AFTER:
   use v4l::device::Device;
   ```

3. Update Cargo.toml to remove platform-specific dependencies:
   ```toml
   # BEFORE:
   [target.'cfg(target_os = "linux")'.dependencies]
   v4l = "0.14"

   # AFTER:
   [dependencies]
   v4l = "0.14"
   ```

4. Remove stub implementations entirely:
   ```rust
   // DELETE ALL OF THESE:
   #[cfg(not(target_os = "linux"))]
   pub struct Camera {
       // stub
   }
   ```

5. Update error messages and documentation:
   - Remove "Linux-only" warnings
   - Update README to clarify Linux requirement
   - Remove platform-specific error handling

SPECIFIC PATTERNS TO REMOVE:

1. In main.rs:
   ```rust
   // Remove the non-Linux main() at the bottom
   #[cfg(not(target_os = "linux"))]
   fn main() -> std::io::Result<()> {
       // DELETE THIS ENTIRE FUNCTION
   }
   ```

2. In camera.rs:
   ```rust
   // Remove all stub structs and implementations
   #[cfg(not(target_os = "linux"))]
   pub struct Camera { ... } // DELETE

   #[cfg(not(target_os = "linux"))]
   impl Camera { ... } // DELETE
   ```

3. In templates.rs:
   ```rust
   // Remove stub error types
   #[cfg(not(target_os = "linux"))]
   pub enum TemplateError { ... } // DELETE
   ```

VALIDATION STEPS:

For Container Approach:
1. Verify `./dev.sh up` starts successfully
2. Check application runs at http://localhost:8080
3. Ensure hot reload works with code changes
4. Test all functionality within container

For Code Removal Approach:
1. Ensure no #[cfg] attributes remain in codebase
2. Verify code compiles on Linux
3. Update CI/CD to Linux-only builds
4. Remove any platform-specific documentation

MIGRATION CHECKLIST:

Container Approach:
□ Dockerfile.dev created
□ docker-compose.dev.yml configured
□ dev.sh script working
□ Development environment tested
□ README updated with container instructions

Code Removal Approach:
□ All #[cfg(target_os = "linux")] removed
□ All #[cfg(not(target_os = "linux"))] blocks deleted
□ Stub implementations removed
□ Cargo.toml simplified
□ Documentation updated
□ CI/CD updated for Linux-only

BENEFITS OF LINUX-ONLY:
- Simpler codebase without conditionals
- Easier to read and maintain
- No stub implementations to maintain
- Clear platform requirements
- Optimized for production environment

RECOMMENDED NEXT STEPS:
1. Try container approach first
2. If containers don't work for your workflow, proceed with code removal
3. Update documentation to reflect Linux-only nature
4. Consider GitHub Codespaces or remote development as alternatives
